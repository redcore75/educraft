<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.channys.mapper.CommonCodeGroupMapper">
	<select id="getPageHelperCntByParamMap" parameterType="HashMap" resultType="long">
		<![CDATA[
		SELECT count(*)
			FROM common_code_group
		WHERE is_del != 'Y'
		]]><trim prefix="AND">
			<if test="sch_option != null and sch_option == 1">
				(code_group_id = #{sch_value} OR code_group_name like CONCAT('%', #{sch_value}, '%'))
			</if>
			<if test="sch_option != null and sch_option == 2">
				code_group_id = #{sch_value}
			</if>
			<if test="sch_option != null and sch_option == 3">
				code_group_name like CONCAT('%', #{sch_value}, '%')
			</if>
		</trim>
	</select>
	
	<select id="getPageHelperByParamMap" parameterType="HashMap" resultType="CommonCodeGroup">
		<![CDATA[
		SELECT rnum, code_group_id, code_group_name, is_valid, is_del, memo,
				       regby,
				       date_format(regdate, '%Y/%m/%d') as regdate,
				       uptby,
				       date_format(uptdate, '%Y/%m/%d') as uptdate
			  FROM 
			       (SELECT (@row_num:=@row_num+1)as rnum , 
			              ccg.* 
			          FROM common_code_group ccg,(SELECT(@row_num:=0)) b
			         WHERE is_del != 'Y'
			         ]]><trim prefix="AND">
			         <if test="sch_option != null and sch_option == 1">
			         	(code_group_id = #{sch_value} OR code_group_name like CONCAT('%', #{sch_value}, '%'))
			         </if>
			         <if test="sch_option != null and sch_option == 2">
			         	code_group_id = #{sch_value}
			         </if>
			         <if test="sch_option != null and sch_option == 3">
			         	code_group_name like CONCAT('%', #{sch_value}, '%')
			         </if>
			         </trim>
			         <![CDATA[
			         ORDER BY ccg.regdate DESC
			       ) a 
			 WHERE rnum >= #{start} 
			       AND rnum <= (#{start}-1) + #{size}
		]]>
	</select>
</mapper>